#!/bin/bash
#SBATCH --job-name=annotate_dataset
#SBATCH --output=annotate_output.log
#SBATCH --error=annotate_error.log
#SBATCH --time=2:00:00
#SBATCH --mem=8G
#SBATCH --partition=gpu      # Ensure it runs on a GPU node
#SBATCH --gres=gpu:1         # Request 1 GPU
#SBATCH --export=ALL

echo "ğŸš€ Starting annotation at $(date) on $(hostname)"
echo "ğŸ” Checking SLURM-assigned GPU resources..."
scontrol show job $SLURM_JOB_ID | grep Gres

echo "ğŸ” Checking available GPUs on this node..."
nvidia-smi

echo "ğŸ” Python version being used..."
which python
python --version

echo "ğŸ” Testing YOLO before running annotation..."
python -c "from ultralytics import YOLO; model = YOLO('yolov8n.pt'); print('âœ… YOLO loaded successfully!')"

echo "ğŸ” Checking if PyTorch detects the GPU..."
python -c "import torch; print(f'CUDA Available: {torch.cuda.is_available()}'); print(f'Device Count: {torch.cuda.device_count()}'); print(f'Using Device: {torch.cuda.get_device_name(0) if torch.cuda.is_available() else None}')"
python -c "import torch; print(torch.__version__); print(torch.cuda.is_available())"


echo "ğŸ” Running the annotation script..."
python ~/annotate.py ~/dataset

echo "âœ… job completed at $(date)"
